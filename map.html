<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" href="/images/favicon.ico" type="image/vnd.microsoft.ico">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.css" />
    <!--<link rel="stylesheet" type="text/css" href="./semantic/dist/semantic.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" ></script>
    <script src="./semantic/dist/semantic.min.js"></script>-->
    <title>Map</title>
    <style>
      #mapid { height: 100%; width: 100%; margin: auto; }
      .block { display: inline-block; margin: 20px; }
      #arrow:hover { cursor: pointer; }
    </style>
    <script>

    </script>
  </head>

  <body>
    <div id="mapid"></div>

    <script src="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>
    <script>

      var greenIcon = L.icon({
          iconUrl: 'images/leaf-green.png',
          shadowUrl: 'images/leaf-shadow.png',

          iconSize:     [19, 47.5], // size of the icon
          shadowSize:   [25, 32], // size of the shadow
          iconAnchor:   [11, 47], // point of the icon which will correspond to marker's location
          shadowAnchor: [2, 31],  // the same for the shadow
          popupAnchor:  [-1.5, -38] // point from which the popup should open relative to the iconAnchor
      });

      var mymap = L.map('mapid').setView([61.215299, -149.895440], 13);

		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
			id: 'mapbox.streets'
		}).addTo(map);

      var userLocation;
      var userLocationCircle;

      var getUserLocation = function() {
        var startPos;
        var geoSuccess = function(position) {
          startPos = position;
          var lat = startPos.coords.latitude;
          var lng = startPos.coords.longitude;

          if(userLocation !== undefined && userLocation !== null){
            mymap.removeLayer(userLocation)
          }
          if(userLocationCircle !== undefined && userLocationCircle !== null){
            mymap.removeLayer(userLocationCircle)
          }

          mymap.fitBounds([[lat, lng]]);
          userLocationCircle = L.circle([lat, lng], (25)).addTo(mymap);
          userLocation = L.marker([lat, lng], {icon: greenIcon}).addTo(mymap)
            .bindPopup("<b>" + "You're approximately here" + "</b>").openPopup();
        };
        
        navigator.geolocation.getCurrentPosition(geoSuccess);
      };

      var findMe = L.Control.extend({
        options: {
          position: 'topleft'
        },
        onAdd: function(map) {
          var findMeIcon = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-custom')
          findMeIcon.style.backgroundColor = 'white'
          findMeIcon.style.width = '26px'
          findMeIcon.style.height = '26px'
          findMeIcon.style.display ='flex'
          findMeIcon.id = 'arrow'
          findMeIcon.innerHTML = '<i class="large location arrow icon" style="margin: auto auto;"></i>'
          findMeIcon.onclick = () => {
            getUserLocation();
          }
          return findMeIcon;
        }
      });
      mymap.addControl(new findMe());

    </script>
  </body>
</html>